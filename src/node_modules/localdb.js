/******************************************************************************
  LOCALDB COMPONENT
******************************************************************************/
module.exports = localdb

function localdb () {
  return { add, read, drop, push, length }

  function length (keys) {
    if(keys) {
      data = JSON.parse(localStorage[keys[0]] || '{}')
      let temp = data
      keys.slice(1, -1).forEach(key => {
        temp = temp[key]
      })
      return Object.keys(temp).length
    }
    return Object.keys(localStorage).length
  }
  //for object
  function add (keys, value) {
    let data
    if(keys.length > 1) {
      data = JSON.parse(localStorage[keys[0]])
      let temp = data
      keys.slice(1, -1).forEach(key => {
        temp = temp[key]
      })
      temp[keys.slice(-1)[0]] = value
    }
    else
      data = value
    localStorage[keys[0]] = JSON.stringify(data)
  }
  //for arrays
  function push (keys, value) {
    const data = JSON.parse(localStorage[keys[0]])
    let temp = data
    keys.slice(1).forEach(key => {
      temp = temp[key]
    })
    temp.push(value)
    localStorage[keys[0]] = JSON.stringify(data)
  }
  function read (keys) {
    let data = localStorage[keys[0]] && JSON.parse(localStorage[keys[0]])
    data && keys.slice(1).forEach(key => {
      data = data[key]
    })
    return data
  }
  function drop (keys) {
    if(keys.length > 1){
      const data = JSON.parse(localStorage[keys[0]])
      let temp = data
      keys.slice(1, -1).forEach(key => {
        temp = temp[key]
      })
      if(Array.isArray(temp))
        temp.splice(keys[keys.length - 1], 1)
      else
        delete(temp[keys[keys.length - 1]])
      localStorage[keys[0]] = JSON.stringify(data)
    }
    else
      delete(localStorage[keys[0]])
  }
}